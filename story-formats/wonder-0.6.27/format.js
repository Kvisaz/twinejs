var SOURCE = '<!DOCTYPE html>\n' +
    '    <html lang="ru">\n' +
    '        <head>\n' +
    '            <meta name="viewport" content="width=device-width, initial-scale=1">\n' +
    '            <meta charset="utf-8">\n' +
    '            <title>{{STORY_NAME}}</title>\n' +
    '            <style></style>\n' +
    '        </head>\n' +
    '        <body>\n' +
    '            <tw-story tags></tw-story>\n' +
    '            {{STORY_DATA}}\n' +
    '            <script>' + "!function(t){var e={};function n(o){if(e[o])return e[o].exports;var a=e[o]={i:o,l:!1,exports:{}};return t[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var a in t)n.d(o,a,function(e){return t[e]}.bind(null,a));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,\"a\",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p=\"\",n(n.s=8)}([function(t,e,n){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.STORY_SELECTOR=\"tw-storydata\",e.PASSAGE_SELECTOR=\"tw-passagedata\",e.COMMON_CSS={displayNone:\"displayNone\",pointerOver:\"pointerOver\",visited:\"visited\",back:\"back\",back2:\"back2\"},e.WONDER={shadowScreenClass:\"scr-shadow\",preloadId:\"preload\",wrapperId:\"wrapperId\",sideBarId:\"sideBarId\",sideBar2Id:\"sideBar2Id\",preloadAnchorId:\"preload-anchor\",startScreenId:\"start-screen\",newGameBtId:\"new-game-button\",continueBtId:\"continue-button\",buttonClass:\"w-button\",contentId:\"wonder-content\",pageClass:\"page\",pageContentClass:\"page-content\",textClass:\"text\",choiceClass:\"choice\",inlineClass:\"inline\",linkClass:\"link\",pressedClass:\"pressed\",linkAloneClass:\"link-alone\",newLineClass:\"newLine\",linkInlineClass:\"inline\",noSelectClass:\"noselect\",selectClass:\"select\",paramClass:\"params\",visitedClass:e.COMMON_CSS.visited,backClass:e.COMMON_CSS.back,backClass2:e.COMMON_CSS.back2,invisibleClass:e.COMMON_CSS.displayNone,template:{text:\"<text/>\",choices:\"<choices/>\",choiceStart:\"<choice>\",choiceEnd:\"</choice>\",choiceText:\"<choice-text/>\",choiceId:\"<choice-id/>\"},passages:{config:\"wonder.config\",pageFormat:\"wonder.format.page\",choiceFormat:\"wonder.format.choice\",textFormat:\"wonder.format.text\"},markLang:{varStart:\"var\",commandSplitter:\":\"},replace:{button:{id:\"#id#\",command:\"#command#\",label:\"#label#\"}},inlineStart:\"=\"};e.REGEXP={exeScript:new RegExp(\"{{([\\\\s\\\\S]*?)}}\",\"g\"),twineLink:new RegExp(\"\\\\[\\\\[([\\\\s\\\\S]*?)\\\\]\\\\]\",\"g\")},e.PRELOAD_PAGE_TEMPLATE=\"<div id=\"+e.WONDER.preloadAnchorId+\"></div>\",e.PAGE_TEMPLATE='<div class=\"'+e.WONDER.noSelectClass+\" \"+e.WONDER.pageClass+'\"></div>',e.LINK_TEMPLATE='<button class=\"'+e.WONDER.linkClass+\"  \"+e.WONDER.linkAloneClass+'\" data-id=\"'+e.WONDER.template.choiceId+'\">'+e.WONDER.template.choiceText+\"</button>\",e.LINK_INLINE_TEMPLATE='<span  class=\"'+e.WONDER.inlineClass+'\" ><button class=\"'+e.WONDER.linkClass+'\" data-id=\"'+e.WONDER.template.choiceId+'\">'+e.WONDER.template.choiceText+\"</button></span>\",e.BACK_TEMPLATE='<button class=\"'+e.WONDER.backClass+'\">Назад</button>',e.BACK_COLLECTION_TEMPLATE='<button class=\"'+e.WONDER.backClass+\" \"+e.WONDER.backClass2+'\">Закрыть</button>',e.BT_START_TEMPLATE='<button id=\"'+e.WONDER.replace.button.id+'\" class=\"'+e.WONDER.buttonClass+'\" data-command=\"'+e.WONDER.replace.button.command+'\">'+e.WONDER.replace.button.label+\"</button>\",e.GAME_MENU_BUTTON_TEMPLATE='<button id=\"menu-main-button\" class=\"menu-main-button\">'+e.WONDER.replace.button.label+\"</button>\",e.PASSAGE_TEMPLATE='<div class=\"'+e.WONDER.pageContentClass+'\">\\n<div class=\"'+e.WONDER.paramClass+'\" ><div id=\"gold\"></div></div>\\n<div class=\"'+e.WONDER.textClass+'\"><text/>'+e.BACK_TEMPLATE+\"</div>\\n</div>\",e.PASSAGE_COLLECTION_TEMPLATE='<div class=\"'+e.WONDER.pageContentClass+'\">\\n'+e.BACK_COLLECTION_TEMPLATE+'<div class=\"'+e.WONDER.textClass+'\"><text/>'+e.BACK_TEMPLATE+\"</div>\\n</div>\"},function(t,e,n){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var o=function(){function t(){}return t.divWith=function(t){var e=document.createElement(\"div\");return e.innerHTML=t,e},t.elementFromTemplate=function(e){return t.divWith(e).firstChild},t.addChildBefore=function(t,e,n){var o,a=!0,i=t.children;if(null!=n&&0!=n.length){for(var r=0;r<i.length;r++)if((o=i[r]).id==n)return t.insertBefore(e,o),void(a=!1);a&&t.appendChild(e)}else t.appendChild(e)},t.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)},t.addChildIfNot=function(t,e){e.parentNode!=t&&t.appendChild(e)},t.bringToTop=function(t){t.parentNode&&t.parentNode.appendChild(t)},t.matches=function(t,e){return a.call(t,e)},t.copyToClipboard=function(t){var e=document.createElement(\"textarea\");e.value=t,document.body.appendChild(e),e.select(),document.execCommand(\"copy\"),document.body.removeChild(e)},t.getBlobURL=function(t,e){var n=new Blob([t],{type:e});return URL.createObjectURL(n)},t.getHtmlBlobUrl=function(e){return t.getBlobURL(e,\"text/html\")},t.removeAllChildren=function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},t.getTextMetrics=function(e,n){null==t.canvas&&(t.canvas=document.createElement(\"canvas\"));var o=t.canvas.getContext(\"2d\");return o.font=n,o.measureText(e)},t.getTextWidth=function(e,n){return t.getTextMetrics(e,n).width},t.isFullScreenEnabled=function(){return document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled},t.closest=function(e,n){var o=e,a=0;do{if(null==o)return null;if(t.matches(o,n))return o;o=o.parentElement}while(a++<1e4)},t.prepend=function(t,e){t.insertBefore(e,t.firstChild)},t}();e.DomUtils=o;var a=Element.prototype.matches||Element.prototype.matchesSelector||Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector},function(t,e,n){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var o=function(){};e.STORY_STORE=new o;var a=function(){};e.STORE=new a;var i=function(){this.hasSave=!1,this.textBuffer=[],this.commands=[]};e.RUNTIME_STORE=new i},function(t,e,n){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var o=n(10),a=n(5),i=function(){function t(){this.listeners={}}return t.prototype.getListeners=function(t){return this.listeners[t]},t.prototype.initListeners=function(t){return this.listeners[t]=[],this.listeners[t]},t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.addListener=function(e,n){(t.getInstance().getListeners(e)||t.getInstance().initListeners(e)).push(n)},t.prototype.sub=function(t,e){return(this.getListeners(t)||this.initListeners(t)).push(e),this},t.prototype.unsub=function(t,e){var n=this.getListeners(t);if(null!=n)return a.ArrayUtils.removeChild(n,e),this},t.emit=function(e,n){var a=t.getInstance().getListeners(e);a&&a.forEach((function(t){o.Task.order((function(){t(e,n)}))}))},t}();e.EventBus=i},function(t,e,n){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var o=n(0),a=function(){function t(){}return t.create=function(t){var e=document.createElement(\"div\");return e.id=t,document.body.appendChild(e),e},t.createSideBar1=function(){return t.create(o.WONDER.sideBarId)},t.createSideBar2=function(){return t.create(o.WONDER.sideBar2Id)},t.getSideBar1=function(){return document.querySelector(\"#\"+o.WONDER.sideBarId)},t.getSideBar2=function(){return document.querySelector(\"#\"+o.WONDER.sideBar2Id)},t}();e.SideBarView=a},function(t,e,n){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var o,a=function(){function t(){}return t.getRandom=function(t,e){void 0===e&&(e=1);var n=new Array(e),o=t.length,a=new Array(o);if(e>o)throw new RangeError(\"getRandom: more elements taken than available\");for(;e--;){var i=Math.floor(Math.random()*o);n[e]=t[i in a?a[i]:i],a[i]=--o in a?a[o]:o}return n},t.pushUnique=function(t,e){return t.indexOf(e)<0&&t.push(e),t},t.removeChild=function(t,e){var n=t.indexOf(e);n>-1&&t.splice(n,1)},t.remove=function(t,e){return e>-1?t.splice(e,1)[0]:null},t.removeLast=function(t,e){for(;e-- >0;)t.pop()},t.shuffleWithSeed=function(t,e){var n,o;void 0===e&&(e=17);var a,i=t.length;for(n=0;n<i;n++)o=t[a=(e*n+31)%i],t[a]=t[n],t[n]=o;return t},t.shuffle=function(e,n){switch(void 0===n&&(n=o.random),n){case o.same:return e;case o.chaos:return e.sort((function(t,e){return Math.random()-.5}));case o.random:return t.shuffleWithSeed(e,13)}},t.updateArray=function(t,e,n,o){var a,i;(void 0===o&&(o=!0),null!=t&&null!=e&&0!=e.length)&&t.forEach((function(t,o){a=o<e.length?e[o]:i,n(t,a),i=a}))},t}();e.ArrayUtils=a,function(t){t.random=\"random\",t.same=\"same\",t.chaos=\"chaos\"}(o=e.ArrayShuffleOrder||(e.ArrayShuffleOrder={}))},function(t,e,n){\"use strict\";function o(){return document.querySelector(\"#twine-user-stylesheet\").innerHTML.trim()}function a(t){for(var e,n,o,a,i={},r=0,s=t.attributes,c=s.length;r<c;r++)i[(e=s[r].name,n=void 0,o=void 0,a=void 0,n=e.split(\"-\"),o=n.map((function(t,e){return e?t.charAt(0).toUpperCase()+t.slice(1).toLowerCase():t})),a=o.join(\"\"),a)]=s[r].value;return i}Object.defineProperty(e,\"__esModule\",{value:!0}),e.parseTwineData=function(){var t=document.body.querySelector(\"tw-storydata\"),e=a(t);e.style=o(),e.script=document.querySelector(\"#twine-user-script\").innerHTML.trim();var n=Array.prototype.slice.call(t.querySelectorAll(\"tw-passagedata\"));return e.passageHash={},e.passages=n.map((function(t){var n,o,i=a(t);return e.passageHash[i.pid],e.passageHash[i.name]=i,e.startnode==i.pid&&(e.startPassageName=i.name),i.content=(n=t.innerHTML.trim(),(o=document.createElement(\"textarea\")).innerHTML=n,0===o.childNodes.length?\"\":o.childNodes[0].nodeValue),i})),e},e.getTwineStoryStyle=o},function(t,e,n){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var o=n(0);e.formatTwinePassageAsHTML=function(t,e){var n=o.WONDER.template,i=function(t,e,n){var o,a,i=[],r=0;for(;r<t.length;){if(-1===(o=t.indexOf(e,r)))return i;-1===(a=t.indexOf(n,o))&&(a=void 0),i.push(t.substring(o+e.length,a)),r=a+n.length}return i}(e,n.choiceStart,n.choiceEnd)[0];e=e.replace(i,n.choiceText).replace(n.choiceStart,\"\").replace(n.choiceEnd,\"\"),t=function(t){return t.split(/(?:\\r\\n|\\r|\\n)/).map((function(t,e){return 0==(t=t.trim()).length?\"\":\"<p>\"+t+\"</p>\"})).join(\"\\n\")}(t=t.replace(o.REGEXP.twineLink,(function(t,e){var n=(e=e.trim())[0]==o.WONDER.inlineStart;n&&(e=e.substring(1));var i=n?o.LINK_INLINE_TEMPLATE:o.LINK_TEMPLATE;return function(t,e){return e.replace(o.WONDER.template.choiceId,t.id).replace(o.WONDER.template.choiceText,t.text)}(function(t){var e=t.split(\"|\");e[0]=e[0].trim(),null==e[1]&&(e[1]=e[0]);return new a(e[0],e[1])}(e),i)})).trim());var r=e;return r=r.replace(n.text,t.trim())};var a=function(t,e){this.text=t,this.id=e}},function(t,e,n){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var o=n(9),a=n(31),i=n(6);n(39);var r=i.getTwineStoryStyle();new a.GameView(r);(new o.GameLogic).start()},function(t,e,n){\"use strict\";var o=this&&this.__assign||function(){return(o=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)},a=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var o=Array(t),a=0;for(e=0;e<n;e++)for(var i=arguments[e],r=0,s=i.length;r<s;r++,a++)o[a]=i[r];return o};Object.defineProperty(e,\"__esModule\",{value:!0});var i=n(3),r=n(11),s=n(0),c=n(12),u=n(13),l=n(14),p=n(15),d=n(2),h=n(6),f=n(16),m=n(19),g=n(22),v=n(23),y=n(24),b=n(25),E=n(26),S=n(27),w=n(29),C=n(30),O=function(){function t(){var t=this;this.defaultGameVars={},this.isUserSaveDisabledFlag=!1,this.isLoading=!1,this.gameSaveName=b.SaveNameDefault,this.isDesktop=!1,this.gameConfig=new c.GameConfig,this.startScreen=new E.StartScreen,this.gameMenu=new S.GameMenu,this.history=new l.WonderHistory,this.collections=new m.Collections,this.preprocessor=new v.Preprocessor,this.postMessageApi=new y.PostMessageApi,this.stateRepo=new f.StateRepository(this.postMessageApi),this.audioPlayer=new g.AudioPlayer,this.userScriptApi=new u.UserScriptApi(this.postMessageApi),this.gameMenuButtons=w.BrowserMenuButtons,window.w=this.userScriptApi,window.Wonder=window.w,d.STORE.state=null,d.STORE.user=null,d.STORY_STORE.story=null,i.EventBus.getInstance().sub(\"onPassagePrepared\",(function(e,n){return t.onPassagePrepared(n)})).sub(\"onLinkClick\",(function(e,n){return t.onClick(n)})).sub(\"onBackClick\",(function(e){return t.onBackClick()})).sub(\"onButtonClick\",(function(e,n){return t.onButtonClick(n)}))}return t.prototype.start=function(t){var e=this;this.showPreloader().then((function(t){return e.startParsing(t)})).then((function(t){return e.onStoryLoad(t)})).then((function(){return e.preloadUserState()})).then((function(t){return e.initUserState(t)})).then((function(){return e.preloadGameState()})).then((function(t){return e.initGameState(t)})).then((function(){return e.showStartScreen()}))},t.prototype.showPreloader=function(){var t=this;return new Promise((function(e,n){t.isUserSaveDisabledFlag=!0;var o=new r.PreloadPageViewData;t.screenType=\"preload\",t.onScreenPrepareCallback=e,t.startPage(o)}))},t.prototype.startParsing=function(t){return new Promise((function(t,e){t(h.parseTwineData())}))},t.prototype.onStoryLoad=function(t){return new Promise((function(e,n){d.STORY_STORE.story=t,e()}))},t.prototype.preloadUserState=function(){var t=this;return new Promise((function(e,n){d.STORE.user=new p.UserState,t.execStoryScript(),t.stateRepo.load(t.getUserDataSaveName(),(function(t){return e(t)}),(function(t){e(null)}))}))},t.prototype.initUserState=function(t){var e=this;return new Promise((function(n,a){null!=t&&(d.STORE.user=o(o({},d.STORE.user),t),C.UserStateUtils.restoreCollectedAsVisited(d.STORE.user)),e.collections.onUserStateReady(d.STORY_STORE.story,d.STORE.user.visitedPageMap),n()}))},t.prototype.preloadGameState=function(){var t=this;return new Promise((function(e,n){t.stateRepo.load(t.getGameAutoSaveName(),(function(t){return e(t)}),(function(t){e(null)}))}))},t.prototype.initGameState=function(t){var e=this;return new Promise((function(n,o){var a=null!=t;d.RUNTIME_STORE.hasSave=a,e.startScreen.onGameStateLoaded(a),d.STORE.state=new p.AppState,d.STORE.state.gameVars=JSON.parse(JSON.stringify(e.defaultGameVars)),n()}))},t.prototype.updateGameState=function(t){null!=t&&(d.STORE.state=t,this.collections.onStateUpdate())},t.prototype.onGameStateLoad=function(t){this.updateGameState(t),this.startTwineGame()},t.prototype.execStoryScript=function(){this.preprocessor.beforeInitUserScript(),this.exeScript(d.STORY_STORE.story.script,this.defaultGameVars),this.execUserScriptCommands()},t.prototype.showStartScreen=function(){var t=this;this.screenType=\"startScreen\",this.startPage({passage:this.startScreen.getPassage(),canGoBack:!1,config:this.gameConfig,gameVars:d.STORE.state.gameVars,visitedPagesMap:{},pagesMap:{}}),setTimeout((function(){t.gameMenu.setup({windowOptions:t.getMenuOptions()})}),b.GameMenuButtonDelay)},t.prototype.getStartPage=function(t,e){var n=this.history.getLastExisting();return null!=n?n:t.startPassageName},t.prototype.startTwineGame=function(t){this.screenType=\"game\";var e=null!=t?t:this.getStartPage(d.STORY_STORE.story,d.STORE.state);this.isUserSaveDisabledFlag=!1,this.onClick(e)},t.prototype.startPage=function(t){i.EventBus.emit(\"preparePassage\",t)},t.prototype.onPassagePrepared=function(t){switch(this.screenType){case\"preload\":this.onScreenPrepareCallback(t);break;case\"startScreen\":break;case\"game\":this.onGameScreenPrepareCallback(t)}i.EventBus.emit(\"showPassage\",t)},t.prototype.onGameScreenPrepareCallback=function(t){this.autoSave(),this.audioPlayer.musicCheck(t.name)},t.prototype.onClick=function(t){var e=JSON.parse(JSON.stringify(d.STORY_STORE.story.passageHash[t]));this.collections.onPassage(e),this.history.add(t),d.STORE.user.visitedPageMap[t]=!0,this.preprocessor.exec(e);var n=this.execPassage(e);this.startPage(n)},t.prototype.onBackClick=function(){this.history.pop();var t=this.history.getLast();this.onClick(t)},t.prototype.onButtonClick=function(t){var e=t.command;\"newGame\"!=e?\"continue\"!=e?\"restart\"!=e||this.restartAsync(t.name,t.delay):this.loadGameState(this.getGameAutoSaveName()):this.startTwineGame()},t.prototype.exeScript=function(t,e){var n=null;try{n=new Function(t).bind(e)()}catch(t){}return n},t.prototype.execPassage=function(t){return this.execScripts(t),this.execUserScriptCommands(),new r.PageViewData(t,d.STORE.state.gameVars,this.gameConfig,this.history.canGoBack(t.name),d.STORE.state.history.pagesHash,d.STORY_STORE.story.passageHash)},t.prototype.execScripts=function(t){var e=this,n=d.STORE.state.gameVars;this.clearRunTimeTextBuffer(),t.content=t.content.replace(s.REGEXP.exeScript,(function(t,o){var a=o.trim(),i=a[0]==s.WONDER.inlineStart;i&&(a=\"return \"+a.substring(1));var r=e.exeScript(a,n),c=e.getRunTimeTextsFromBuffer();return i?r:c}))},t.prototype.getRunTimeTextsFromBuffer=function(){for(var t=d.RUNTIME_STORE.textBuffer,e=\"\";t.length>0;)e+=t.shift();return e},t.prototype.clearRunTimeTextBuffer=function(){d.RUNTIME_STORE.textBuffer=[]},t.prototype.execUserScriptCommands=function(){for(var t=d.RUNTIME_STORE.commands;t.length>0;)this.execSingleUserCommand(t.shift())},t.prototype.execSingleUserCommand=function(t){switch(t.name){case\"enableExternalApi\":this.isDesktop=1==t.data,this.stateRepo.enableExternalApi(t.data);break;case\"saveSlot\":var e=null!=t.data?t.data:\"_default\";this.saveName(e);break;case\"save\":if(this.isUserSaveDisabled())return;this.saveGameState(t.data);break;case\"load\":break;case\"collectionRule\":this.collections.addRule(t.data);break;case\"music\":this.audioPlayer.music(t.data.url,t.data.volume);break;case\"musicFor\":this.audioPlayer.musicFor(t.data.hashName,t.data.url,t.data.volume);break;case\"sound\":this.audioPlayer.sound(t.data.url,t.data.volume);break;case\"musicStop\":this.audioPlayer.stop();break;case\"start\":this.restartAsync(t.data.name,t.data.delay);break;case\"pageAdd\":this.preprocessor.addRule({tag:t.data.tag,text:t.data.text,text2:\"\",position:\"end\"});break;case\"pageBefore\":this.preprocessor.addRule({tag:t.data.tag,text:t.data.text,text2:\"\",position:\"start\"});break;case\"pageWrap\":this.preprocessor.addRule({tag:t.data.tag,text:t.data.text,text2:t.data.text2,position:\"around\"});break;case\"startPage\":this.startScreen.userOptions(t.data)}},t.prototype.isUserSaveDisabled=function(){return this.isUserSaveDisabledFlag},t.prototype.saveName=function(t){null!=t&&(this.gameSaveName=t)},t.prototype.saveGameState=function(t){null==t&&(t=this.getGameSaveName()),this.stateRepo.save(t,d.STORE.state,x,x)},t.prototype.saveUserState=function(){this.stateRepo.save(this.getUserDataSaveName(),d.STORE.user,x,x)},t.prototype.loadGameState=function(t){var e=this;this.isLoading=!0,this.stateRepo.load(t,(function(t){e.isLoading=!1,e.onGameStateLoad(t)}),(function(t){e.isLoading=!1}))},t.prototype.getGameName=function(){return d.STORY_STORE.story.name},t.prototype.getGameSaveName=function(){return b.SavePrefixGame+this.getGameName()+\"-\"+this.gameSaveName},t.prototype.getGameAutoSaveName=function(){return b.SavePrefixGameAuto+this.getGameName()+\"-\"+b.SaveNameAuto},t.prototype.getUserDataSaveName=function(){return b.SavePrefixUser+this.getGameName()+\"-\"+b.SaveNameDefault},t.prototype.autoSave=function(){if(!this.isLoading){var t=this.getGameAutoSaveName();this.saveGameState(t),this.saveUserState()}},t.prototype.restartAsync=function(t,e){var n=this,o=null!=e?parseInt(e):0;setTimeout((function(){return n.restart(t)}),o)},t.prototype.restart=function(t){d.STORE.state.gameVars=JSON.parse(JSON.stringify(this.defaultGameVars)),d.STORE.state.history.pages=[],d.STORE.state.history.pagesHash={},this.startTwineGame(t)},t.prototype.getMenuOptions=function(){return this.isDesktop?this.getDesktopMenuOptions():this.getBrowserMenuOptions()},t.prototype.getMenuCommonOptions=function(){return{addClass:\"menu-win\",title:\"Меню игры\"}},t.prototype.getBrowserMenuOptions=function(){var t=this;return o(o({},this.getMenuCommonOptions()),{buttons:[{text:\"Продолжить игру\",callback:function(){}},{text:\"Начать игру заново\",callback:function(){t.restartAsync(null,\"0\")},warning:\"Вы уверены?\"}]})},t.prototype.getDesktopMenuOptions=function(){var t=this,e=this.getBrowserMenuOptions(),n=[{text:\"Во весь экран / окно\",callback:function(){t.postMessageApi.send(\"fullScreen\",null)}},{text:\"Выйти\",callback:function(){t.postMessageApi.send(\"close\",null)},warning:\"Вы уверены?\"}];return e.buttons=a(e.buttons,n),e},t}();function x(t){}e.GameLogic=O},function(t,e,n){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var o=requestAnimationFrame?function(t){return requestAnimationFrame(t)}:function(t){return setTimeout(t,0)};e.Task={order:o}},function(t,e,n){\"use strict\";var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,\"__esModule\",{value:!0});var i=n(0),r=function(t,e,n,o,a,i){this.passage=t,this.gameVars=e,this.config=n,this.canGoBack=o,this.visitedPagesMap=a,this.pagesMap=i};e.PageViewData=r;var s={pid:i.WONDER.preloadId,position:\"\",name:i.WONDER.preloadId,tags:i.WONDER.preloadId,size:\"\",content:i.PRELOAD_PAGE_TEMPLATE},c=function(t){function e(){return t.call(this,s,{},{uiParams:[]},!1,{},{})||this}return a(e,t),e}(r);e.PreloadPageViewData=c},function(t,e,n){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var o=function(){};e.GameState=o;var a=function(){this.uiParams=[]};e.GameConfig=a;var i=function(t,e){this.name=t,this.label=e};e.VisibleParameter=i},function(t,e,n){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var o=n(2),a=function(){function t(t){this.autoload=this.autoLoad,this.autosave=this.autoSave,this.postMessageApi=t,this.includedScripts={},this.includedStyles={}}return t.prototype.styleUrl=function(t){if(!this.includedStyles[t]){this.includedStyles[t]=!0;var e=document.createElement(\"link\");e.setAttribute(\"rel\",\"stylesheet\"),e.setAttribute(\"href\",t),document.head.appendChild(e)}},t.prototype.jsUrl=function(t,e){if(!this.includedScripts[t]){this.includedScripts[t]=!0;var n=document.createElement(\"script\");n.type=\"text/javascript\",e&&(n.onload=function(){e()}),n.src=t,document.head.appendChild(n)}},t.prototype.collect=function(t){o.RUNTIME_STORE.commands.push({name:\"collectionRule\",data:t})},t.prototype.music=function(t,e){void 0===e&&(e=1),o.RUNTIME_STORE.commands.push({name:\"music\",data:{url:t,volume:e}})},t.prototype.musicFor=function(t,e,n){void 0===n&&(n=1),o.RUNTIME_STORE.commands.push({name:\"musicFor\",data:{url:e,volume:n,hashName:t}})},t.prototype.sound=function(t,e){void 0===e&&(e=1),o.RUNTIME_STORE.commands.push({name:\"sound\",data:{url:t,volume:e}})},t.prototype.musicStop=function(){o.RUNTIME_STORE.commands.push({name:\"musicStop\",data:null})},t.prototype.parentApi=function(){return this.postMessageApi},t.prototype.disableLocalSave=function(t){void 0===t&&(t=!0),o.RUNTIME_STORE.commands.push({name:\"enableExternalApi\",data:!t})},t.prototype.enableExternalApi=function(t){void 0===t&&(t=!0),o.RUNTIME_STORE.commands.push({name:\"enableExternalApi\",data:t})},t.prototype.hasSave=function(){return o.RUNTIME_STORE.hasSave},t.prototype.autoLoad=function(t){void 0===t&&(t=!0)},t.prototype.autoSave=function(t){void 0===t&&(t=!0)},t.prototype.saveSlot=function(t){o.RUNTIME_STORE.commands.push({name:\"saveSlot\",data:t})},t.prototype.save=function(t){null!=t&&this.saveSlot(t),o.RUNTIME_STORE.commands.push({name:\"save\",data:t})},t.prototype.load=function(t){null!=t&&this.saveSlot(t),o.RUNTIME_STORE.commands.push({name:\"load\",data:t})},t.prototype.startPage=function(t){o.RUNTIME_STORE.commands.push({name:\"startPage\",data:t})},t.prototype.start=function(t,e){void 0===t&&(t=0),void 0===e&&(e=null),o.RUNTIME_STORE.commands.push({name:\"start\",data:{delay:t,name:e}})},t.prototype.showText=function(t){o.RUNTIME_STORE.textBuffer.push(t)},t.prototype.pageAdd=function(t,e){o.RUNTIME_STORE.commands.push({name:\"pageAdd\",data:{tag:t,text:e}})},t.prototype.pageBefore=function(t,e){o.RUNTIME_STORE.commands.push({name:\"pageBefore\",data:{tag:t,text:e}})},t.prototype.pageWrap=function(t,e,n){o.RUNTIME_STORE.commands.push({name:\"pageWrap\",data:{tag:t,text:e,text2:n}})},t}();e.UserScriptApi=a},function(t,e,n){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var o=n(2),a=function(){function t(){}return t.prototype.getState=function(){return o.STORE.state.history},t.prototype.getStory=function(){return o.STORY_STORE.story},t.prototype.add=function(t){null!=t&&this.getLast()!=t&&(this.getState().pages.push(t),this.getState().pagesHash[t]=!0)},t.prototype.isVisited=function(t){return 1==this.getState().pagesHash[t]},t.prototype.pop=function(){return this.getState().pages.pop()},t.prototype.canGoBack=function(t){var e=this.getState().pages;if(!(e.length>0))return!1;var n=1==e.length,o=e[0]&&e[0]==t;return!(n&&o)},t.prototype.getLast=function(){var t=this.getState().pages;return t[t.length-1]},t.prototype.getLastExisting=function(){for(var t,e=this.getStory().passageHash,n=this.getState().pages,o=n.length-1;o>=0;o--){if(null!=e[t=n[o]])return t;n.pop()}return null},t}();e.WonderHistory=a},function(t,e,n){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var o=function(){this.gameVars={},this.history={pagesHash:{},pages:[]}};e.AppState=o;var a=function(){this.collectionMap={},this.visitedPageMap={}};e.UserState=a},function(t,e,n){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var o=n(17),a=n(18),i=function(){function t(t){this.loadTimes={},this.saveTimes={},this.operationDelta=150,this.localRepo=new o.LocalRepository,this.postMessageRepo=new a.PostMessageRepository(t),this.repo=this.localRepo}return t.prototype.enableExternalApi=function(t){this.repo=t?this.postMessageRepo:this.localRepo},t.prototype.load=function(t,e,n){var o=Date.now();o-(this.loadTimes[t]||0)<this.operationDelta||(this.loadTimes[t]=o,this.repo.load(t,e,n))},t.prototype.save=function(t,e,n,o){var a=Date.now();a-(this.saveTimes[t]||0)<this.operationDelta||(this.saveTimes[t]=a,this.repo.save(t,e,n,o))},t}();e.StateRepository=i},function(t,e,n){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var o=function(){function t(){}return t.prototype.save=function(t,e,n,o){try{var a=JSON.stringify(e);localStorage.setItem(t,a),n(\"success\")}catch(e){o(\"localRepository saveError for key [\"+t+\"] :: \"+e)}},t.prototype.load=function(t,e,n){try{var o=localStorage.getItem(t);e(JSON.parse(o))}catch(e){n(\"localRepository loadError for key [\"+t+\"] :: \"+e)}},t}();e.LocalRepository=o},function(t,e,n){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var o=function(){function t(t){this.postMessageApi=t,this.callbacks={},this.setHandlers()}return t.prototype.save=function(t,e,n,o){try{var a=JSON.stringify(e);this.callbacks.save=n,this.callbacks.saveError=o,this.postMessageApi.send(\"save\",{saveName:t,data:a})}catch(e){o(\"postMessageRepository save Error for slotName [\"+t+\" :: \"+e)}},t.prototype.load=function(t,e,n){this.callbacks.load=e,this.callbacks.loadError=n,this.postMessageApi.send(\"load\",{saveName:t})},t.prototype.setHandlers=function(){var t=this;this.setMessageHandler(\"save\"),this.setMessageHandler(\"saveError\"),this.setMessageHandler(\"loadError\"),this.postMessageApi.on(\"load\",(function(e){return t.onLoad(e)}))},t.prototype.setMessageHandler=function(t){var e=this;this.postMessageApi.on(t,(function(n){var o=n.saveName+\" \"+n.data;e.callbacks[t](\"PostMessages.\"+t+\" :: \"+o)}))},t.prototype.onLoad=function(t){var e=t.saveName,n=t.data;try{var o=this.callbacks.load,a=this.callbacks.loadError;if(null==n)a(\"PostMessages.loadError :: null save for \"+e);else o(JSON.parse(n))}catch(t){(a=this.callbacks.loadError)(\"PostMessages.loadError :: \"+t+\"  for \"+e)}},t}();e.PostMessageRepository=o},function(t,e,n){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var o=n(20),a=function(){function t(){this.rules=[],this.collectionsView=new o.CollectionsView}return t.prototype.onUserStateReady=function(t,e){var n=this;this.initCollections(t,e),setTimeout((function(){n.collectionsView.createButtons(n.collectionsMap)}),500)},t.prototype.onStateUpdate=function(){this.collectionsView.updateButtons(this.collectionsMap)},t.prototype.addRule=function(t){null==this.rules&&(this.rules=[]),this.rules.push(t)},t.prototype.onPassage=function(t){var e=this;this.getTags(t).forEach((function(n){return e.collectTag(n,t)})),this.onStateUpdate()},t.prototype.collectTag=function(t,e){var n=this,o=this.rulesMap[t];null==o||o.length<1||o.forEach((function(t){return n.collectByRule(t,e)}))},t.prototype.collectByRule=function(t,e){var n=this.collectionsMap[t.collection];n.collected.indexOf(e.name)<0&&(n.collected.push(e.name),this.onPassageCollected(e,n))},t.prototype.onPassageCollected=function(t,e){this.collectionsView.updateButton(e)},t.prototype.buildCollection=function(t){return{name:t.collection,title:t.title,collected:[],maxAmount:0}},t.prototype.initCollections=function(t,e){var n=this.rules,o=this.buildRuleMap(n),a=this.buildCollections(n),i=this.buildCollectionMap(a);this.calculateAmounts(t,o,i,e),this.removeNullCollections(i),this.rulesMap=o,this.collectionsMap=i},t.prototype.buildCollectionMap=function(t){var e={};return t.forEach((function(t){null==e[t.name]&&(e[t.name]=t)})),e},t.prototype.buildRuleMap=function(t){var e={};return t.forEach((function(t){t.tags.forEach((function(n){null==e[n]&&(e[n]=[]),e[n].push(t)}))})),e},t.prototype.calculateAmounts=function(t,e,n,o){for(var a=t.passages.length,i=0;i<a;i++)this.countPassage(t.passages[i],e,n,o)},t.prototype.countPassage=function(t,e,n,o){var a=this,i=this.getTags(t);null!=i&&i.forEach((function(i){a.countTag(i,e,n,o,t.name)}))},t.prototype.countTag=function(t,e,n,o,a){var i=e[t];null!=i&&i.forEach((function(t){var e=n[t.collection];null!=e&&(e.maxAmount++,1==o[a]&&e.collected.push(a))}))},t.prototype.buildCollections=function(t){var e=this;return null==t?[]:t.map((function(t){return e.buildCollection(t)}))},t.prototype.getTags=function(t){return t.tags.split(\" \")},t.prototype.removeNullCollections=function(t){Object.keys(t).forEach((function(e){t[e].maxAmount<1&&delete t[e]}))},t}();e.Collections=a},function(t,e,n){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var o=n(21),a=n(1),i=n(4),r=function(){function t(){var t=this;this.isViewCreated=!1,this.viewMap={},i.SideBarView.getSideBar1().addEventListener(\"mouseup\",(function(e){return t.findButton(e)}))}return t.prototype.createButtons=function(t){var e=this,n=i.SideBarView.getSideBar1();Object.keys(t).forEach((function(a){var i=t[a],r=new o.SingleCollectionView;e.viewMap[a]=r,r.update(i),r.onCollectionShow((function(t){return e.onCollectionShow(t)})),r.attach(n)})),this.isViewCreated=!0},t.prototype.updateButtons=function(t){var e=this;Object.keys(t).forEach((function(n){var o=t[n];e.updateButton(o)}))},t.prototype.updateButton=function(t){if(this.isViewCreated){var e=this.viewMap[t.name];null!=e&&e.update(t)}},t.prototype.onCollectionShow=function(t){var e=this;Object.keys(this.viewMap).forEach((function(n){t!=n&&e.viewMap[n].closeCollection()}))},t.prototype.findButton=function(t){var e=this,n=a.DomUtils.closest(t.target,\".c-button\");if(null!=n){var o=n.dataset.collection;Object.keys(this.viewMap).forEach((function(t){var n=e.viewMap[t];null!=n&&(t==o?n.showCollection():n.closeCollection())}))}},t}();e.CollectionsView=r},function(t,e,n){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var o=n(2),a=n(7),i=n(0),r=n(1),s=function(){function t(t){void 0===t&&(t=\"c-button\"),this.buttonClass=t,this.buttonEl=this.createButton(t)}return t.prototype.attach=function(t){(t=t||document.body).appendChild(this.buttonEl)},t.prototype.update=function(t){this.updateButton(t),this.collection=t},t.prototype.onCollectionShow=function(t){this.onButtonClickCallback=t},t.prototype.createButton=function(t){var e=document.createElement(\"button\");return e.className=t,this.buttonTitleEl=this.createDiv(\"c-bt-title\"),this.buttonContentEl=this.createDiv(\"c-bt-content\"),e.appendChild(this.buttonTitleEl),e.appendChild(this.buttonContentEl),e},t.prototype.updateButton=function(t){var e=this.buttonEl,n=this.buttonTitleEl,o=this.buttonContentEl;this.collectionName=t.name;var a=t.collected.length,i=t.maxAmount,r=t.title;e.dataset.collection=this.collectionName,n.innerHTML=\"\"+r,o.innerHTML=a+\"/\"+i;var s=a==i?\"c-button-completed\":\"\";e.className=\"c-button \"+this.collectionName+\" \"+s},t.prototype.showCollection=function(){var t=this,e={addClass:\"c-list\",html:this.getListHtml(this.collection),onClick:function(e){return t.onCollectionClick(e)}};this.showKvisazWindow(e),this.onCollectionShow&&this.onButtonClickCallback(this.collectionName)},t.prototype.onCollectionClick=function(t){r.DomUtils.closest(t.target,\".c-list-close\")&&this.closeKvisazWindow(t);var e=r.DomUtils.closest(t.target,\".c-item\");if(e){var n=e.dataset.name;this.onItemClick(n)}else;},t.prototype.getListHtml=function(t){var e=this.getCloseButton();return'<div class=\"c-list-header\">'+('<h1 class=\"c-list-title\">'+t.title+\"</h1>\")+\" \"+e+\"</div>\"+('<div class=\"c-list-content\">'+this.getItemsHTML(t)+\"</div>\")},t.prototype.getCloseButton=function(){return'<button class=\"c-list-close\">Закрыть</button>'},t.prototype.getItemsHTML=function(t){var e=this,n=o.STORY_STORE.story.passageHash,a=\"\";return t.collected.forEach((function(t){var o=n[t],i=e.getPageTitle(o.content),r=e.getItemTemplate(i,t);a+=r})),a},t.prototype.closeCollection=function(){this.closePage()},t.prototype.onItemClick=function(t){var e=o.STORY_STORE.story.passageHash[t];null!=e&&this.showPage(e)},t.prototype.getPageTitle=function(t){var e=function(t,e,n,o){void 0===o&&(o=!1);var a=t.indexOf(e);if(a<0)return\"\";var i=t.indexOf(n,a),r=o?0:e.length,s=o?n.length:0;return t.substring(a+r,i+s)}(t,\"<h1>\",\"</h1>\");return null!=e&&0!=e.length||(e=function(t){var e=t.indexOf(\"\\n\");if(-1===e)return t;return t.substr(0,e)}(t)),e},t.prototype.showPage=function(t){var e=this,n={html:this.getPassageHTML(t),addClass:\"c-page\",onClick:function(t){return e.onPageClick(t)}};this.showKvisazWindow(n)},t.prototype.onPageClick=function(t){this.closeKvisazWindow(t)},t.prototype.getPassageHTML=function(t){var e=t.content.replace(i.REGEXP.exeScript,\"\");return a.formatTwinePassageAsHTML(e,i.PASSAGE_COLLECTION_TEMPLATE)},t.prototype.closePage=function(){},t.prototype.showKvisazWindow=function(t){window.Kvisaz.dialog(t)},t.prototype.closeKvisazWindow=function(t){var e=t.currentTarget;window.Kvisaz.close(e)},t.prototype.createDiv=function(t){var e=document.createElement(\"div\");return e.className=t,e},t.prototype.getItemTemplate=function(t,e){return'<button class=c-item data-name=\"'+e+'\">'+t+\"</button>\"},t}();e.SingleCollectionView=s},function(t,e,n){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var o=function(){function t(){this.musicHash={},this.audioElement=new Audio}return t.prototype.music=function(t,e){this.audioElement.loop=!0,this.play(t,e)},t.prototype.sound=function(t,e){this.audioElement.loop=!1,this.play(t,e)},t.prototype.musicFor=function(t,e,n){this.musicHash[t]={url:e,volume:n}},t.prototype.musicCheck=function(t){var e=this.musicHash[t];null!=e&&this.music(e.url,e.volume)},t.prototype.play=function(t,e){var n=t.trim();this.lastUrl=n,this.audioElement.src=this.lastUrl,this.audioElement.volume=e,(this.audioElement.paused||n!=this.lastUrl)&&this.audioElement.play().then((function(t){}))},t.prototype.stop=function(){this.audioElement.pause()},t}();e.AudioPlayer=o},function(t,e,n){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var o=function(){function t(){}return t.prototype.beforeInitUserScript=function(){this.rulesMap={}},t.prototype.addRule=function(t){this.getRules(t.tag).push(t)},t.prototype.exec=function(t){var e=this;this.getTags(t).forEach((function(n){e.getRules(n).forEach((function(n){return e.useRule(t,n)}))}))},t.prototype.initTag=function(t){null==this.rulesMap[t]&&(this.rulesMap[t]=[])},t.prototype.getRules=function(t){return this.initTag(t),this.rulesMap[t]},t.prototype.getTags=function(t){return t.tags.split(\" \")},t.prototype.useRule=function(t,e){var n=null!=e.text2?e.text2:\"\";switch(e.position){case\"start\":t.content=e.text+t.content;break;case\"end\":t.content=t.content+e.text;break;case\"around\":t.content=e.text+t.content+n}},t}();e.Preprocessor=o},function(t,e,n){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var o=function(){function t(t,e){var n=this;void 0===t&&(t=null),void 0===e&&(e=\"*\"),this.listenerMap={},this.parent=t,null==this.parent&&(this.parent=window.parent),this.targetOrigin=e,window.addEventListener(\"message\",(function(t){return n.onMessage(t)}))}return t.prototype.send=function(t,e){var n={name:t,data:e};this.parent&&this.parent.postMessage(n,this.targetOrigin)},t.prototype.on=function(t,e){null==this.listenerMap[t]&&(this.listenerMap[t]=[]),this.listenerMap[t].push(e)},t.prototype.onMessage=function(t){var e=t.data;if(null!=e.name){var n=this.listenerMap[e.name];n&&n.forEach((function(t){return t(e.data)}))}},t}();e.PostMessageApi=o},function(t,e,n){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.SavePrefixGame=\"w-game-custom-\",e.SavePrefixGameAuto=\"w-game-auto-\",e.SavePrefixUser=\"w-user-\",e.SaveNameDefault=\"data\",e.SaveNameAuto=\"save\",e.GameMenuButtonDelay=0},function(t,e,n){\"use strict\";var o=this&&this.__assign||function(){return(o=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)};Object.defineProperty(e,\"__esModule\",{value:!0});var a=n(0),i={newGame:\"New Game\",continue:\"Continue\",continueOff:!1,title:\"Welcome to game\",text:\"Choice your destiny:\"},r=function(){function t(){this.passage={pid:a.WONDER.startScreenId,position:\"\",name:a.WONDER.startScreenId,tags:a.WONDER.startScreenId,size:\"\",content:a.PRELOAD_PAGE_TEMPLATE},this.options=o({},i)}return t.prototype.userOptions=function(t){this.options=o(o({},i),t)},t.prototype.onGameStateLoaded=function(t){var e=1==this.options.continueOff||!t;this.options=o(o({},this.options),{continueOff:e}),this.setup(this.options)},t.prototype.setup=function(t){this.passage.content=this.createContent(t)},t.prototype.getPassage=function(){return this.passage},t.prototype.createContent=function(t){var e=this.getTitleCode(t),n=this.getTextCode(t),o=this.getNewGameButtonCode(t);return e+n+(1==t.continueOff?\"\":this.getContinueButtonCode(t))+o},t.prototype.getString=function(t,e){return null==t?e.trim():t},t.prototype.getButtonCode=function(t,e,n){return a.BT_START_TEMPLATE.replace(a.WONDER.replace.button.id,e).replace(a.WONDER.replace.button.command,n).replace(a.WONDER.replace.button.label,t)},t.prototype.getNewGameButtonCode=function(t){var e=this.getString(t.newGame,\"New Game\");return this.getButtonCode(e,a.WONDER.newGameBtId,\"newGame\")},t.prototype.getContinueButtonCode=function(t){var e=this.getString(t.continue,\"Continue\");return this.getButtonCode(e,a.WONDER.continueBtId,\"continue\")},t.prototype.getTitleCode=function(t){var e=this.getString(t.title,\"\");return 0==e.length?\"\":\"<h1>\"+e+\"</h1>\"},t.prototype.getTextCode=function(t){var e=this.getString(t.text,\"\");return 0==e.length?\"\":\"<p>\"+e+\"</p>\"},t}();e.StartScreen=r},function(t,e,n){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var o=n(28),a=n(1),i=n(0),r=n(4),s=function(){function t(){var t=this;this.buttonEl=this.createButton(\"menu-main-button\"),this.buttonEl.addEventListener(\"click\",(function(e){return t.onMainButtonClick(e)})),r.SideBarView.getSideBar1().appendChild(this.buttonEl)}return t.prototype.setup=function(t){this.windowOptions=t.windowOptions,this.showMainButton()},t.prototype.onMainButtonClick=function(t){window.Kvisaz.dialog(this.windowOptions)},t.prototype.createButton=function(t){var e=a.DomUtils.elementFromTemplate(i.GAME_MENU_BUTTON_TEMPLATE);e.className=t,e.innerHTML=o.IcSvgSettings;return e.setAttribute(\"aria-label\",\"Меню игры\"),e.setAttribute(\"title\",\"Меню игры\"),e},t.prototype.showMainButton=function(){this.buttonEl.classList.add(\"menu-main-button-visible\")},t}();e.GameMenu=s},function(t,e,n){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.IcSvgSettings='<svg class=\"svg-settings\" width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" fill=\"none\" stroke=\"#dedede\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\"><path d=\"M13 2 L13 6 11 7 8 4 4 8 7 11 6 13 2 13 2 19 6 19 7 21 4 24 8 28 11 25 13 26 13 30 19 30 19 26 21 25 24 28 28 24 25 21 26 19 30 19 30 13 26 13 25 11 28 8 24 4 21 7 19 6 19 2 Z\"></path><circle cx=\"16\" cy=\"16\" r=\"4\"></circle></svg>'},function(t,e,n){\"use strict\";var o=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var o=Array(t),a=0;for(e=0;e<n;e++)for(var i=arguments[e],r=0,s=i.length;r<s;r++,a++)o[a]=i[r];return o};Object.defineProperty(e,\"__esModule\",{value:!0}),e.MenuGameButtonLabel=\"Настройки\",e.MenuGamTitleLabel=\"Настройки\",e.BrowserMenuButtons=[{command:\"restart\",label:\"Новая игра\",hint:\"Начать с первой локации\"}],e.DesktopMenuButtons=o([{command:\"close\",label:\"Закрыть игру\",hint:\"Alt + F4 : Выйти\"},{command:\"fullScreen\",label:\"Полный экран/окно\",hint:\"F11: Переключить\"}],e.BrowserMenuButtons)},function(t,e,n){\"use strict\";var o=this&&this.__assign||function(){return(o=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)};Object.defineProperty(e,\"__esModule\",{value:!0});var a=function(){function t(){}return t.restoreCollectedAsVisited=function(t){if(!(t.visitedPageMap&&Object.keys(t.visitedPageMap).length>0)&&(null!=t.collectionMap&&Object.keys(t.collectionMap).length>0)){var e,n,a=(e=t.collectionMap,n={},Object.keys(e).map((function(t){return e[t]})).forEach((function(t){t.collected&&t.collected.forEach((function(t){return n[t]=!0}))})),n);t.visitedPageMap=o({},a)}},t}();e.UserStateUtils=a},function(t,e,n){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var o=n(3),a=n(0),i=n(32),r=n(1),s=n(37),c=n(4),u=function(){function t(t){var e=this;this.injectStyle(s.DEFAULT_STYLE),this.injectStyle(t);var n=document.createElement(\"div\");n.id=a.WONDER.wrapperId;var r=c.SideBarView.createSideBar1(),u=c.SideBarView.createSideBar2();this.el=document.createElement(\"div\"),this.el.id=a.WONDER.contentId,n.appendChild(r),n.appendChild(this.el),n.appendChild(u),document.body.appendChild(n),this.el.addEventListener(\"click\",this),this.pageView=new i.WonderPageView(this.el),o.EventBus.getInstance().sub(\"onStoryLoaded\",(function(t,n){return e.onStoryLoad(n)})).sub(\"preparePassage\",(function(t,n){return e.preparePassage(n)})).sub(\"showPassage\",(function(t,n){return e.showPassage(n)}))}return t.prototype.injectStyle=function(t){if(0!=t.length){var e=document.createElement(\"style\");e.innerHTML=t,document.getElementsByTagName(\"head\")[0].appendChild(e)}},t.prototype.handleEvent=function(t){this.checkLinkClick(t)||this.checkBackClick(t)||this.checkButtonClick(t)},t.prototype.checkClick=function(t,e,n){var o=r.DomUtils.closest(t.target,e);if(!(null!=o))return!1;var i=!o.classList.contains(a.WONDER.pressedClass);return i&&(o.classList.add(a.WONDER.pressedClass),n(o,t)),i},t.prototype.checkLinkClick=function(t){return this.checkClick(t,\".\"+a.WONDER.linkClass,(function(t,e){var n=t.dataset.id;o.EventBus.emit(\"onLinkClick\",n)}))},t.prototype.checkBackClick=function(t){return this.checkClick(t,\".\"+a.WONDER.backClass,(function(t,e){o.EventBus.emit(\"onBackClick\",null)}))},t.prototype.checkButtonClick=function(t){return this.checkClick(t,\".\"+a.WONDER.buttonClass,(function(t,e){var n=JSON.parse(JSON.stringify(t.dataset));o.EventBus.emit(\"onButtonClick\",n)}))},t.prototype.onStoryLoad=function(t){},t.prototype.preparePassage=function(t){var e=t.passage,n=this.pageView.addNextPage(e);this.setBody(e),this.markVisitedLinks(n,t.visitedPagesMap,t.pagesMap),this.showBackLink(n,t.canGoBack,e),this.injectParams(n,t.config.uiParams,t.gameVars),o.EventBus.emit(\"onPassagePrepared\",e)},t.prototype.setBody=function(t){document.body.id=t.name,document.body.className=t.tags},t.prototype.showPassage=function(t){this.pageView.showNextPage()},t.prototype.injectParams=function(t,e,n){e.forEach((function(e){var o=e.name,a=n[e.name],i=t.querySelector(e.name);i&&(i.innerHTML=o+\":\"+a)}))},t.prototype.markVisitedLinks=function(t,e,n){for(var o,i,r=t.querySelectorAll(\".\"+a.WONDER.linkClass),s=0;s<r.length;s++){e[i=(o=r[s]).dataset.id]&&o.classList.add(a.WONDER.visitedClass);var c=n[i];c&&c.tags&&(o.className=o.className+\" \"+c.tags)}},t.prototype.showBackLink=function(t,e,n){var o=t.querySelector(\".\"+a.WONDER.backClass);null!=o&&(e?o.classList.remove(a.WONDER.invisibleClass):o.classList.add(a.WONDER.invisibleClass))},t}();e.GameView=u},function(t,e,n){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var o=n(33),a=n(3),i=n(36),r=n(0),s=n(7),c=function(){function t(t){var e=this;this.parent=t,this.pageView=new o.PagePairView,this.pageBuilder=new i.ViewBuilder(r.PAGE_TEMPLATE),this.contentBuilder=new i.ViewBuilder(r.PASSAGE_TEMPLATE),this.contentBuilder.setContentFormatter(s.formatTwinePassageAsHTML),a.EventBus.getInstance().sub(\"onPageFormatLoaded\",(function(t,n){return e.pageBuilder.setTemplate(n)})).sub(\"onPassageFormatLoaded\",(function(t,n){return e.contentBuilder.setTemplate(n)}))}return t.prototype.addNextPage=function(t){var e=this.buildPageView(t);return this.pageView.addPage(e),e},t.prototype.showNextPage=function(){this.pageView.next()},t.prototype.buildPageView=function(t){var e=t.content,n=this.contentBuilder.build(e),o=this.pageBuilder.build();return o.classList.add(r.COMMON_CSS.displayNone),o.appendChild(n),this.parent.appendChild(o),o},t}();e.WonderPageView=c},function(t,e,n){\"use strict\";var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,\"__esModule\",{value:!0});var i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.limit=2,e}return a(e,t),e.prototype.addPage=function(e){t.prototype.addPage.call(this,e),this.pages.length>this.limit&&(this.currentPage--,this.dropPage(0))},e}(n(34).PageView);e.PagePairView=i},function(t,e,n){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var o=n(35),a=n(5),i=n(1),r=function(){function t(){this.pages=[],this.currentPage=-1,this.animator=new o.PageAnimator}return t.prototype.setAnimator=function(t){this.animator=t},t.prototype.addPage=function(t){this.pages.push(t)},t.prototype.next=function(){var t=this.getCurrent();this.currentPage++,this.setCurrent(this.currentPage);var e=this.getCurrent();this.switch(t,e)},t.prototype.previous=function(){var t=this.getCurrent();this.currentPage--,this.setCurrent(this.currentPage);var e=this.getCurrent();this.switch(t,e)},t.prototype.switch=function(t,e){t&&this.animator.hide(t),this.animator.show(e)},t.prototype.getCurrent=function(){return this.pages[this.currentPage]},t.prototype.setCurrent=function(t){if(0==this.pages.length)throw\"setCurrent error - void pages\";var e=this.pages.length-1;t>e?t=0:t<0&&(t=e),this.currentPage=t},t.prototype.dropPage=function(t){var e=a.ArrayUtils.remove(this.pages,t);null!=e&&i.DomUtils.remove(e)},t}();e.PageView=r},function(t,e,n){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var o=n(0),a=function(){function t(){}return t.prototype.show=function(t,e){void 0===e&&(e=0),t.classList.remove(o.COMMON_CSS.displayNone)},t.prototype.hide=function(t,e){void 0===e&&(e=0),t.classList.add(o.COMMON_CSS.displayNone)},t}();e.PageAnimator=a},function(t,e,n){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var o=n(1),a=function(){function t(t){this.template=t,this.contentFormatter=function(t,e){return e}}return t.prototype.setTemplate=function(t){this.template=t},t.prototype.setContentFormatter=function(t){this.contentFormatter=t},t.prototype.build=function(t){void 0===t&&(t=\"\");var e=this.contentFormatter(t,this.template);return o.DomUtils.elementFromTemplate(e)},t}();e.ViewBuilder=a},function(t,e,n){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var o=n(0),a=n(38);e.DEFAULT_STYLE=\"\\n     * {user-select: none;}\\n    .noselect { user-select: none; }    \\n    .select {  user-select: text; }\\n    .page .displayNone, .displayNone {\\n        display: none; \\n    }\\n    \\n    tw-story, tw-storydata {\\n        display: none;\\n    }\\n    \\n    html, body{height: 100%}\\n    \\n    ul, li {\\n        margin: 0;\\n        padding: 0;\\n        list-style: none;\\n    }\\n    \\n    h1:first-letter, .\"+o.WONDER.textClass+\" p:first-letter { text-transform: uppercase; }\\n    h1::first-letter, .\"+o.WONDER.textClass+' p::first-letter { text-transform: uppercase; }\\n    \\n    body {\\n        margin: 0;\\n        padding: 0;\\n        background: #ceceb7;\\n        font-family: \"Verdana\", \"Roboto\", \"Open Sans\", sans-serif;\\n        position: relative;\\n        \\n    }\\n    \\n    #'+o.WONDER.wrapperId+'{\\n        width: 100%;\\n        height: 100%;\\n        display: flex;\\n        justify-content: space-between;\\n        flex-direction: row;\\n        align-items: start;\\n    }\\n    \\n    button {\\n        border: none;\\n        padding: 0;\\n        font-family: \"Verdana\", \"Roboto\", \"Open Sans\", sans-serif;\\n        cursor: pointer;\\n    }\\n    \\n    .'+o.WONDER.shadowScreenClass+\" {\\n       position: absolute;\\n        width: 100%;\\n        height: 100%;\\n        background: #000;\\n        opacity: 0.3;\\n        top:0;\\n        left: 0;\\n    }\\n    \\n    .\"+o.WONDER.newLineClass+\" {\\n        display: block;\\n    }\\n    \\n    #\"+o.WONDER.contentId+\" {\\n        width: 800px;\\n        border-radius: 0 0 8px 8px;\\n        overflow: auto;\\n    }\\n    \\n    .\"+o.WONDER.pageClass+\" {\\n          background: beige;          \\n     }\\n     \\n     #\"+o.WONDER.preloadId+\" .\"+o.WONDER.pageClass+\" {\\n        background: none;\\n     }\\n     \\n     .\"+o.WONDER.pageContentClass+\" {\\n          display: flex;\\n          flex-direction: column;\\n          padding: 12px;\\n     }\\n        \\n    .\"+o.WONDER.paramClass+\"{\\n        margin-bottom: 12px;\\n    }        \\n        \\n    .\"+o.WONDER.textClass+\", .\"+o.WONDER.textClass+\" button {\\n        margin: 0;    \\n        font-size: 18px;    \\n    }\\n    \\n    .\"+o.WONDER.textClass+\" p {\\n        margin: 1em 0;        \\n    }\\n    \\n    #\"+o.WONDER.startScreenId+\" .w-button {\\n        margin: 0 auto 1em; \\n    }\\n    \\n    .\"+o.WONDER.linkClass+\"{\\n        display: block;\\n        padding: 5px 35px;\\n        border-radius: 5px;\\n        background: #d5c695;\\n    }   \\n        \\n    .\"+o.WONDER.inlineClass+\" .\"+o.WONDER.linkClass+\"{\\n        display: inline;\\n    }  \\n    \\n        \\n    .\"+o.WONDER.linkClass+\":hover, .\"+o.WONDER.backClass+\":hover{\\n        color: #4b0d1e;\\n        background: #d5b562;       \\n    }\\n    \\n    .\"+o.WONDER.visitedClass+\":after {\\n        content: '  (прочитано)';\\n        font-size: smaller;\\n     }\\n     \\n     .\"+o.WONDER.visitedClass+\" {\\n        opacity: 0.65;\\n        font-size: smaller;\\n     }\\n    \\n    .\"+o.WONDER.backClass+\" {\\n        margin-left: 0;\\n        margin-right: auto;\\n        margin-bottom: 4px;\\n        padding: 5px 35px 5px 17px;\\n        border-radius: 5px;\\n        background: #eae2c5;\\n        color: #6c6c6c;\\n    }\\n    \\n     .\"+o.WONDER.backClass+\":before {\\n        content: '<';\\n     }\\n     \\n     .\"+o.WONDER.buttonClass+\" {\\n        display: block;\\n        margin: 4px auto 0.65em;\\n        width: 12em;\\n        text-align: center;\\n        background: #c6c3b2;\\n        padding: 12px;\\n        text-transform: uppercase;\\n        transition:all 0.21s ease-out;\\n     }\\n     \\n     .\"+o.WONDER.pressedClass+\"{\\n        opacity: 0.55;\\n     }\\n    \\n    .\"+o.WONDER.buttonClass+\":not(.\"+o.WONDER.pressedClass+\"):active {\\n        transform: translateY(0.15em);\\n    }\\n    \\n    .\"+o.WONDER.linkAloneClass+\"{\\n        margin-top: 0px;\\n    }\\n    \\n    .\"+o.WONDER.linkAloneClass+\":hover{\\n        transform: translateY(-2px);\\n        box-shadow: 2px 2px 1px #414141;\\n    }    \\n    \\n    #\"+o.WONDER.sideBarId+\"{\\n        display: flex;\\n        flex-direction: column;\\n    }\\n    \\n    #\"+o.WONDER.sideBarId+\" button {\\n        width: 96px;\\n        margin-right: 0;\\n        margin-top: 16px;\\n        box-shadow: none;\\n        border-radius: 0 8px 8px 0;\\n        border: 1px slategrey solid;\\n        overflow: hidden;\\n    }   \\n    \\n    #\"+o.WONDER.sideBarId+\" button:hover {\\n        transform: translateY(-2px);\\n    }\\n    \\n    .c-button{\\n        line-height: 1em;\\n        background: antiquewhite;\\n        text-align: center;\\n        box-shadow: 1px 2px 6px black;\\n    }\\n    \\n    .c-bt-title{\\n        font-size: 16px;\\n        text-align: center;\\n        height: 1em;\\n        line-height: 1em;\\n        background: #643903;\\n        color: #dedede;\\n        margin-bottom: 12px;\\n        padding: 2px;\\n    }\\n    \\n    .c-bt-content{\\n        font-size: 24px;\\n        text-align: center;\\n        height: 1em;\\n        line-height: 1em;\\n        margin-bottom: 12px;\\n    }\\n    \\n    .c-list{\\n        /*position: absolute;\\n        height: 89%;*/\\n        width: 800px;\\n        height: 100%;        \\n        /*top: 10%;\\n        left: 0;\\n        transform: translate(-110%, 0);*/\\n        background: beige;\\n       /* transition-duration: 0.45s;\\n        animation-timing-function: ease-out;*/\\n        box-shadow: 1px 2px 6px rgba(0,0,0,0.65);       \\n    }\\n    \\n    .kvisaz-createWindow-content {\\n        height: 100%;\\n        display: flex;\\n        flex-direction: column;  \\n    }\\n    \\n    .c-list .kvisaz-createWindow-content {\\n        padding: 12px;\\n        color: antiquewhite;\\n        background: #815f3d;   \\n    }\\n    \\n    .c-list-show{\\n        left: 50%;\\n        transform: translate(-49%, 0);\\n    }\\n    \\n    .c-list-header{\\n        display: flex;\\n        flex-direction: row;\\n        justify-content: space-between;\\n        align-items: center;\\n     }    \\n     \\n    .c-list-title{\\n        font-size: 32px;\\n        margin: 2px;\\n     }\\n     \\n     .c-list-close{\\n        border-radius: 8px;\\n        font-size: 12px;\\n        height: 32px;\\n        background: beige;\\n     }\\n        \\n    .c-list-content{        \\n        padding: 12px;\\n        background: #d7d7c5;\\n        color: black;\\n        border: 1px solid #afafaf;\\n        overflow: auto;\\n        flex: 1;\\n    }\\n    \\n    button.c-item{\\n         font-size: 24px;\\n         width: 100%;\\n         text-align: left;\\n         display: block;    \\n         padding: 12px;\\n         border: 1px solid #afafaf;\\n         cursor: pointer;\\n         background: beige;\\n         border-radius: 4px;\\n         margin-top: 6px;\\n    }\\n    \\n    .c-item:hover {\\n        transform: scale(1.01);\\n        background: #fffffc;\\n        box-shadow: 1px 2px 6px rgba(0,0,0,0.65);\\n    }   \\n    \\n    .c-list-content::-webkit-scrollbar { width: 32px; }\\n        \\n    .c-list-content::-webkit-scrollbar-track {\\n        background: #d0ac75;\\n        border-radius: 16px;    \\n    }\\n    .c-list-content::-webkit-scrollbar-thumb {\\n          background-color: #f1760c;   \\n          border-radius: 20px;       \\n          border: 2px solid #6f3909; \\n    }\\n    \\n    .c-page{\\n        height: 95%;\\n        width: 800px;        \\n        background: beige;\\n        box-shadow: 1px 2px 6px rgba(0,0,0,0.65);\\n    }\\n    \\n    .c-page h1{\\n        margin: 0;\\n    }\\n    \\n    .c-page .\"+o.WONDER.pageContentClass+\" {\\n        overflow: auto;\\n    }\\n    \\n    .c-page .\"+o.WONDER.backClass2+\" {\\n        position: absolute;\\n        right: 4px;\\n        top: 4px;\\n    }\\n    \\n    .c-page::-webkit-scrollbar { width: 32px; }\\n        \\n    .c-page::-webkit-scrollbar-track {\\n        background: #d0ac75;\\n        border-radius: 16px;    \\n    }\\n    .c-page::-webkit-scrollbar-thumb {\\n          background-color: #ce9643;   \\n          border-radius: 20px;       \\n          border: 2px solid #efd0a6; \\n    }\\n    \\n    #menu-main-button{\\n        order: 0;\\n        background: #c6c3b2;\\n        width: 96px;\\n        height: 68px;\\n        display: flex;\\n        justify-content:center;\\n        align-items: center;\\n        padding: 0;\\n        margin: 0;\\n    }\\n    \\n    \\n    #menu-main-button svg{\\n        \\n    }\\n    \\n    #menu-main-button svg path{\\n        stroke: #534633;\\n        stroke-width: 2px;\\n        fill: #362e23;\\n        stroke-opacity: 0.5;\\n    }\\n    \\n    #menu-main-button svg circle{\\n        fill: beige;\\n    }\\n    \\n    \\n    \\n    .menu-main-button-visible:active{\\n         box-shadow:none;\\n         transform: translateY(2px);   \\n    }\\n    \\n    \\n    .menu-main-button-content{\\n    }\\n    \\n    .menu-win{\\n        \\n    }\\n    \\n    .kvisaz-createWindow button{\\n        min-width: 100px;\\n    }\\n    \\n    \"+a.CSSDefaultMobileStyle+\"\\n\"},function(t,e,n){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var o=n(0);e.CSSDefaultMobileStyle=\"\\n\\n@media screen and (max-width: 1080px){\\n\\n    body {\\n        flex-direction: column;\\n        justify-content: start;\\n        align-items: center;\\n    }\\n    \\n    #\"+o.WONDER.wrapperId+\"{\\n        flex-direction: column;\\n        justify-content: start;\\n        align-items: center;\\n    }\\n    \\n             \\n    #\"+o.WONDER.contentId+\" {\\n         order: 0;   \\n         width: 100%;\\n         margin: 0;\\n         border-radius: 0;\\n         flex: 1;\\n    }\\n    \\n    #\"+o.WONDER.sideBarId+\"{\\n        order: 1;\\n        display: flex;\\n        flex-direction: row;\\n        flex-wrap: wrap;\\n        top: 0;\\n        left: 0;\\n        justify-content: center;\\n        align-items: center;\\n      }\\n      \\n    #\"+o.WONDER.sideBarId+\" button {\\n        width: 96px;\\n        height: 72px;\\n        margin-right: 8px;\\n        margin-top: 4px;\\n        margin-bottom: 4px;\\n        border-radius: 8px;\\n        box-shadow: none;\\n    }    \\n   \\n            \\n    .c-list, .c-page {\\n         width: 100%;\\n         margin: 0;\\n         border-radius: 0;\\n    }\\n        \\n         \\n            \\n        .kvisaz-dialog {\\n            width: 90%;\\n        }        \\n    }\\n\\n@media screen and (max-width: 640px){\\n    .c-bt-title {\\n        font-size: 14px;\\n    }  \\n    .c-bt-content {\\n        font-size: 14px;\\n    }  \\n    \\n    #\"+o.WONDER.sideBarId+\" button {\\n        width: 64px;\\n        height: 64px;\\n    }       \\n \\n}\\n  \\n\"},function(t,e){!function(t){const e={};window.Kvisaz=e,e.moduleName=\"Kvisaz\",e.window=o,e.dialog=o,e.getWrapperSelector=()=>\".\"+n.wrapperClass,e.close=a,e.optionHash={},e.counter=0;const n={wrapperClass:\"kvisaz-createWindow-wrapper\",shadowClass:\"kvisaz-shadow\",winId:\"kvisaz-createWindow\",warningClass:\"kvisaz-createWindow-warning\",winClass:\"kvisaz-createWindow\",winClassShow:\"kvisaz-createWindow-show\",winContentClass:\"kvisaz-createWindow-content\",titleClass:\"kvisaz-createWindow-title\",textClass:\"kvisaz-createWindow-text\",buttonClass:\"kvisaz-createWindow-button\",buttonWrapClass:\"kvisaz-button-wrap\",styleId:\"kvisaz-createWindow-style\"};function o(t){e.counter++,e.optionHash[e.counter]=t;const o=i(n.wrapperClass);!function(t,e){t.dataset.optionsId=e}(o,e.counter),o.classList.add(n.shadowClass);const a=function(t){if(null==t.html){const e=function(t){return d(t,\"title\",n.titleClass)}(t),o=function(t){return d(t,\"text\",n.textClass)}(t),a=function(t){if(null==t.buttons||0==t.buttons.length)return;return r(t.buttons.map(h).join(\"\\n\"),n.buttonWrapClass)}(t);t.html=e+o+a}return function(t){const e=function(){const t=i(n.winClass);return t.id=n.winId,t}();null!=t.addClass&&e.classList.add(t.addClass);return e.innerHTML=`<div class=\"${n.winContentClass}\">${t.html}</div>`,function(t){setTimeout(t,0)}(()=>e.classList.add(n.winClassShow)),e}(t)}(t);return o.appendChild(a),o.addEventListener(\"click\",s),document.body.appendChild(o),o}function a(t){const n=t,o=u(n);var a;e.optionHash[o]=null,delete e.optionHash[o],n.removeEventListener(\"click\",s),null!=(a=n).parentNode&&a.parentNode.removeChild(a)}function i(t){const e=document.createElement(\"div\");return t&&(e.className=t),e}function r(t,e){return`<div class=\"${e}\">${t}</div>`}function s(t){t.stopImmediatePropagation();const e=l(t.currentTarget);e.onClick?e.onClick(t):t.target.classList.contains(n.buttonClass)&&function(t){try{const e=t.dataset.index,a=t.dataset.warning,i=l(t).buttons[e].callback;null!=a?function(t,e,a){o({addClass:n.warningClass,text:e,buttons:[{text:\"OK\",callback:a},{text:\"Cancel\",callback:()=>{}}]})}(0,a,()=>{p(t,i)}):p(t,i)}catch(t){}}(t.target)}function c(t){return t.closest(`.${n.wrapperClass}`)}function u(t){return c(t).dataset.optionsId}function l(t){const n=u(t);return e.optionHash[n]}function p(t,e){setTimeout(()=>{!function(t){const e=c(t);null!=e&&a(e)}(t)},0),setTimeout(()=>{e&&e()},0)}function d(t,e,n){return null==t[e]?\"\":r(t[e],n)}function h(t,e){const o=null!=t.warning?`data-warning=\"${t.warning}\"`:\"\";return`<button class=\"${n.buttonClass}\" ${o} data-index=\"${e}\">${t.text}</button>`}!function(t){const e=document.createElement(\"style\");e.innerHTML=t,e.id=n.styleId,document.head.appendChild(e)}(`\\n        .${n.wrapperClass} {\\n            position: fixed;\\n            width: 100%;\\n            height: 100%;\\n            top: 0;\\n            left: 0;\\n            display: flex;\\n            align-items: center;\\n            justify-content: center;\\n        }\\n\\n        .${n.shadowClass} {\\n            background: rgba(0,0,0,0.75);\\n        }\\n        \\n        .${n.winId} {\\n            user-select: none;\\n            font-family: Roboto, Verdana, Arial, sans-serif;\\n        }        \\n        .${n.winClass} {\\n            opacity: 1;\\n            transition: all 0.2s ease-in;\\n            width: 35%;\\n            background: beige;\\n            margin-top: 100%;\\n        }        \\n        \\n        .${n.winClassShow} {  \\n          margin: 0;    \\n        }\\n        \\n        .${n.winContentClass} {}\\n        \\n        .${n.titleClass} {\\n            background: bisque;\\n            text-align: center;\\n            padding: 1em;\\n        }\\n        .${n.textClass} {\\n            text-align: center;\\n            padding: 1em;\\n        }\\n        \\n        .${n.buttonWrapClass} {\\n            display: flex;\\n            flex-wrap: wrap;\\n            justify-content: center;\\n            margin-bottom: 1em;\\n        }\\n        .${n.buttonClass} {\\n            display: flex;\\n            justify-items: center;\\n            align-content: center;\\n            align-items: center;\\n            justify-content: center;\\n            background: #dedede;\\n            cursor: pointer;\\n            padding: 1em;\\n            margin: 1em;\\n            text-align: center;\\n            border: 2px outset #c4c0c0;\\n            transform: scale(1);\\n        }\\n        \\n        .${n.buttonClass}:active {\\n            transform: translateY(0.15em);\\n            border: 2px solid #c4c0c0;\\n        }\\n    `)}()}]);"+ '</script>' +
    '        </body>\n' +
    '    </html>';


window.storyFormat({
    name: 'twine-wonder',
    version: '0.6.27',
    author: 'Kvisaz [Sergey Tokarev]',
    description: 'Twine Wonder Format',
    proofing: false,
    url: 'https://github.com/Kvisaz/twine-wonder',
    image: 'icon.svg',
    source: SOURCE,
});
